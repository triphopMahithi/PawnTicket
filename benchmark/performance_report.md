# Performance report
---
<p>การทดสอบทั้งหมดนี้เป็นเพียงการทดสอบบน Desktop PC ดังนั้นผลที่ได้ขึ้นอยู่กับหลายปัจจัย โดยเราใช้สร้างชุดคำสั่งผ่าน Stored Procedures โดยหากผู้ที่สนใจในการปรับแต่งในการทดสอบสามารถเข้าไปปรับแก้ได้จาก</p>
```
cd PawnTicket/benchmark/
```
<p>
โดยจะสังเกตเห็นว่าไฟล์จะขึ้นต้นด้วย `bench_` โดยเรามีข้อมูลเพิ่มเติมในตอนการทดสอบ Ticket จำนวนมากโดยผู้สนใจสามารถเข้าไปดูในส่วนของ `mock/Tickets` ต่อได้ 
</p>

สรุปขั้นตอนสำหรับการทดสอบ 
1. Warm up memory โดยไม่นำค่าขณะ Warm-up มาคำนวณ
2. ทำการทดสอบแยกระหว่าง Read/Write 
3. ทดสอบผ่านไฟล์สกุล .sql ภายใน `cd PawnTicket/benchmark/test` ซึ่งจะพบว่าเราแยกเป็น 2 กรณีคือ schema_old.sql และ schema_old.sql  โดยใช้ไฟล์ต่างกันแต่เรายังใช้ Bench ร่วมกัน
4. เก็บข้อมูลจากการเปรียบเทียบทั้ง 2 Bench จึงเป็นที่มาของข้อมูลในตารางด้านล่าง 

### Read Benchmarks
1. Read Benchmarks (CALL bench_customer_search_stats)

| query_text        | Test | customer_runs | warmup_j | min_us | max_us | avg_us   | stddev_us | min_ms | max_ms | avg_ms   | stddev_ms |
|-------------------|------|---------------|----------|--------|--------|----------|-----------|--------|--------|----------|-----------|
| "Somchai, 30, 10" | Old  | 30            | 10       | 66     | 104    | 76.7333  | 12.42928  | 0.066  | 0.104  | 0.076733 | 0.012429  |
|                   | New  | 30            | 10       | 66     | 102    | 72.6667  | 8.964126  | 0.066  | 0.102  | 0.072667 | 0.008964  |
| "Som, 30, 10"     | Old  | 30            | 10       | 65     | 125    | 74.3333  | 13.01367  | 0.065  | 0.125  | 0.074333 | 0.013014  |
|                   | New  | 30            | 10       | 70     | 166    | 109.5667 | 20.09259  | 0.07   | 0.166  | 0.109567 | 0.020093  |
| "%cha%, 30, 10"   | Old  | 30            | 10       | 66     | 128    | 76.9     | 14.11701  | 0.066  | 0.128  | 0.0769   | 0.014117  |
|                   | New  | 30            | 10       | 65     | 119    | 70.7333  | 11.01191  | 0.065  | 0.119  | 0.070733 | 0.011012  |

### 2. Write Benchmarks
 2.1 Payment Insert (CALL bench_payment_insert_stats)

| query_text        | Test | customer_runs | warmup_j | min_us | max_us | avg_us   | stddev_us | min_ms | max_ms | avg_ms   | stddev_ms |
|-------------------|------|---------------|----------|--------|--------|----------|-----------|--------|--------|----------|-----------|
| "Somchai, 30, 10" | Old  | 30            | 10       | 66     | 104    | 76.7333  | 12.42928  | 0.066  | 0.104  | 0.076733 | 0.012429  |
|                   | New  | 30            | 10       | 66     | 102    | 72.6667  | 8.964126  | 0.066  | 0.102  | 0.072667 | 0.008964  |
| "Som, 30, 10"     | Old  | 30            | 10       | 65     | 125    | 74.3333  | 13.01367  | 0.065  | 0.125  | 0.074333 | 0.013014  |
|                   | New  | 30            | 10       | 70     | 166    | 109.5667 | 20.09259  | 0.07   | 0.166  | 0.109567 | 0.020093  |
| "%cha%, 30, 10"   | Old  | 30            | 10       | 66     | 128    | 76.9     | 14.11701  | 0.066  | 0.128  | 0.0769   | 0.014117  |
|                   | New  | 30            | 10       | 65     | 119    | 70.7333  | 11.01191  | 0.065  | 0.119  | 0.070733 | 0.011012  |

 2.2 Payment Delete (CALL bench_payment_delete_stats)

 | query_text          | Test | runs | warmup_j | min_us | max_us | avg_us  | stddev_us | min_ms | max_ms | avg_ms  | stddev_ms |
|---------------------|------|------|----------|--------|--------|---------|-----------|--------|--------|---------|-----------|
| Payment DELETE only | Old  | 30   | 10       | 3704   | 5982   | 4113.67 | 503.92    | 3.704  | 5.982  | 4.11367 | 0.50392   |
|                     | New  | 30   | 10       | 3610   | 4971   | 4501.53 | 465.88    | 3.610  | 4.971  | 4.50153 | 0.46588   |

 

2.3 One Ticket (CALL bench_tickets_by_customer_stats)

| query_text          | Test | runs | warmup_j | min_us | max_us | avg_us  | stddev_us | min_ms | max_ms | avg_ms  | stddev_ms |
|---------------------|------|------|----------|--------|--------|---------|-----------|--------|--------|---------|-----------|
| Payment DELETE only | Old  | 30   | 10       | 3704   | 5982   | 4113.67 | 503.92    | 3.704  | 5.982  | 4.11367 | 0.50392   |
|                     | New  | 30   | 10       | 3610   | 4971   | 4501.53 | 465.88    | 3.610  | 4.971  | 4.50153 | 0.46588   |


2.4 Many Tickets (CALL bench_tickets_by_customer_stats)

| query_text          | Test | runs | warmup_j | min_us | max_us | avg_us  | stddev_us | min_ms | max_ms | avg_ms  | stddev_ms |
|---------------------|------|------|----------|--------|--------|---------|-----------|--------|--------|---------|-----------|
| Payment DELETE only | Old  | 30   | 10       | 3704   | 5982   | 4113.67 | 503.92    | 3.704  | 5.982  | 4.11367 | 0.50392   |
|                     | New  | 30   | 10       | 3610   | 4971   | 4501.53 | 465.88    | 3.610  | 4.971  | 4.50153 | 0.46588   |
